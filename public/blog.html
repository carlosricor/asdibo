<!DOCTYPE HTML>
<html class="no-js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Blog - ASDIBO</title>
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="format-detection" content="telephone=no">
<link href="css/bootstrap.css" rel="stylesheet" type="text/css">
<link href="css/bootstrap-theme.css" rel="stylesheet" type="text/css">
<link href="css/style.css" rel="stylesheet" type="text/css">
<link href="vendor/magnific/magnific-popup.css" rel="stylesheet" type="text/css">
<link href="vendor/owl-carousel/css/owl.carousel.css" rel="stylesheet" type="text/css">
<link href="vendor/owl-carousel/css/owl.theme.css" rel="stylesheet" type="text/css">
<link href="css/custom.css" rel="stylesheet" type="text/css">
<link href="colors/color1.css" rel="stylesheet" type="text/css">
<script src="js/modernizr.js"></script></head>
<body>
<div class="body">
	<div class="site-header-wrapper">
        <header class="site-header">
            <div class="container">
                <div class="site-logo">
                    <a href="index.html" class="default-logo"><img src="images/logo.png" alt="ASDIBO" style="max-width:160px;"></a>
                    <a href="index.html" class="default-retina-logo"><img src="images/logo@2x.png" alt="ASDIBO" width="160" height="24"></a>
                    <a href="index.html" class="sticky-logo"><img src="images/sticky-logo.png" alt="ASDIBO" style="max-width:160px;"></a>
                    <a href="index.html" class="sticky-retina-logo"><img src="images/sticky-logo@2x.png" alt="ASDIBO" width="160" height="24"></a>
                </div>
                <a href="#" class="visible-sm visible-xs" id="menu-toggle"><i class="fa fa-bars"></i></a>
                
                 <div class="header-info-col">
                    <i class="fa fa-phone"></i>620 823 633
                    &nbsp;&nbsp;
                    <a href="https://wa.me/34620823633" target="_blank" class="btn btn-sm" style="background:#25D366; color:white; padding:2px 8px; border-radius:15px; font-size:12px;">
                        <i class="fa fa-whatsapp"></i> WhatsApp
                    </a>
                </div>

                <ul class="sf-menu dd-menu pull-right" role="menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="about.html">La Asociación</a></li>
                    <li><a href="hazte-socio.html">Hazte socio</a></li>
                    <li><a href="index.html#eventos">Eventos</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="contact.html">Contacto</a></li>
                </ul>
            </div>
        </header>
    </div>
    <div class="hero-area">
    	<div class="page-banner parallax" style="background-image:url(images/slider/asdibo3.jpg);">
        	<div class="container">
            	<div class="page-banner-text">
        			<h1 class="block-title">Noticias y Actualidad</h1>
                </div>
            </div>
        </div>
    </div>
    <div id="main-container">
    	<div class="content">
        	<div class="container">
            	<div class="row">
                	<div class="col-md-8 content-block">
                        
                        <div id="blog-posts-container">
                            <div class="text-center" style="padding: 50px;">
                                <img src="images/assets/ajax-loader.gif" alt="Cargando...">
                                <p>Cargando noticias...</p>
                            </div>
                        </div>

                        </div>
                    
                    <div class="col-md-4 sidebar-block">
                        
                        <div class="widget sidebar-widget widget_search">
                            <div class="input-group">
                                <input type="text" class="form-control" id="blog-search-input" placeholder="Buscar noticias...">
                                <span class="input-group-btn">
                                    <button class="btn btn-primary" type="button"><i class="fa fa-search"></i></button>
                                </span>
                            </div>
                        </div>

                        <div class="widget sidebar-widget widget_categories">
                            <h3 class="widgettitle">Categorías</h3>
                            <ul id="blog-categories-list">
                                </ul>
                        </div>

                        <div class="widget sidebar-widget widget_recent_entries">
                            <h3 class="widgettitle">Últimos Posts</h3>
                            <ul id="recent-posts-list">
                                </ul>
                        </div>

                        <div class="widget sidebar-widget widget_tag_cloud">
                            <h3 class="widgettitle">Etiquetas</h3>
                            <div class="tagcloud" id="blog-tags-list">
                                </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="site-footer parallax parallax3" style="background-image:url(images/asdibo/footer-bg.jpg)">
        <div class="container">
            <div class="row">
                <div class="col-md-4 col-sm-4">
                    <div class="widget footer_widget">
                        <h4 class="widgettitle">Sobre ASDIBO</h4>
                        <p><img src="images/logo.png" alt="ASDIBO" style="max-width: 160px;"></p>
                        <p>Acompañando, informando y uniendo a las familias con diabetes de Boadilla del Monte.</p>
                        <ul class="social-icons-rounded social-icons-colored">
                            <li class="facebook"><a href="#"><i class="fa fa-facebook-f"></i></a></li>
                            <li class="instagram"><a href="#"><i class="fa fa-instagram"></i></a></li>
                            <li class="mail"><a href="mailto:asdibo@yahoo.es"><i class="icon-mail"></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4 col-sm-4">
                    <div class="widget footer_widget widget_links">
                        <h4 class="widgettitle">Enlaces</h4>
                        <ul>
                            <li><a href="hazte-socio.html">Hazte socio</a></li>
                            <li><a href="index.html#eventos">Eventos</a></li>
                            <li><a href="blog.html">Blog</a></li>
                            <li><a href="contact.html">Contacto</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4 col-sm-4">
                    <div class="widget footer_widget">
                        <h4 class="widgettitle">Contacto</h4>
                        <p>Email: asdibo@yahoo.es</p>
                        <p>Tel: 620 823 633</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="site-footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-sm-6">
                    <div class="copyrights-col-left">
                        <p>&copy; 2026 ASDIBO.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="back-to-top"><i class="fa fa-angle-double-up"></i></a>
</div>

<script src="js/jquery-2.1.3.min.js"></script>

<script src="vendor/magnific/jquery.magnific-popup.min.js"></script> <script src="js/ui-plugins.js"></script> <script src="js/helper-plugins.js"></script> <script src="vendor/owl-carousel/js/owl.carousel.min.js"></script> <script src="js/bootstrap.js"></script> <script src="js/init.js"></script> <script src="vendor/flexslider/js/jquery.flexslider.js"></script> <script src="js/circle-progress.js"></script> </body>


<script>
$(document).ready(function() {
    // 1. URL del JSON (Puede ser local 'js/blog.json' o tu URL de Google Apps Script si usas el Excel)
    var jsonUrl = "js/blog.json"; 
    // var jsonUrl = "AQUI_TU_URL_APPS_SCRIPT_SI_USAS_EXCEL";

    var allPosts = []; // Guardamos todos los posts aquí para poder filtrar sin recargar

    $.getJSON(jsonUrl, function(data) {
        
        // Ordenar por fecha (más reciente primero)
        data.sort(function(a, b) {
            return new Date(b.fecha) - new Date(a.fecha);
        });

        allPosts = data; // Guardamos en memoria
        renderBlog(allPosts); // Pintamos todo inicial
        renderSidebar(allPosts); // Generamos sidebar automática

        // --- NUEVO: LEER PARÁMETROS DE URL Y FILTRAR ---
        
        // Función auxiliar para leer parámetros (ej: ?categoria=Familia)
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        var paramCategoria = getUrlParameter('categoria');
        var paramBusqueda = getUrlParameter('busqueda');

        if (paramCategoria) {
            // Si viene con categoría, simulamos clic en ese filtro
            // 1. Filtramos datos
            var filtered = allPosts.filter(function(p) { return p.categoria === paramCategoria; });
            renderBlog(filtered);
            
            // 2. Marcamos visualmente el botón correcto en la sidebar (esperamos un poco a que se renderice)
            setTimeout(function() {
                $(".filter-link").removeClass("active");
                $(".filter-link[data-filter='" + paramCategoria + "']").addClass("active");
            }, 100);

        } else if (paramBusqueda) {
            // Si viene con búsqueda
            $("#blog-search-input").val(paramBusqueda); // Escribimos en la caja
            var val = paramBusqueda.toLowerCase();
            var filtered = allPosts.filter(function(p) {
                return p.titulo.toLowerCase().indexOf(val) > -1 || 
                       p.resumen.toLowerCase().indexOf(val) > -1;
            });
            renderBlog(filtered);
            
        } else {
            // Si no hay params, mostramos todo
            renderBlog(allPosts);
        }


    }).fail(function() {
        $("#blog-posts-container").html('<div class="alert alert-danger">Error al cargar las noticias.</div>');
    });

    // --- FUNCIÓN DE RENDERIZADO PRINCIPAL ---
    function renderBlog(posts) {
        var container = $("#blog-posts-container");
        container.empty();

        if (posts.length === 0) {
            container.html('<div class="alert alert-warning">No se encontraron noticias con estos criterios.</div>');
            return;
        }

        $.each(posts, function(i, post) {
            // Plantilla HTML de cada post
            var html = `
            <div class="blog-post standard-post">
                ${ post.imagen ? `
                <div class="post-media">
                    <a href="${post.enlace}">
                        <img src="${post.imagen}" alt="${post.titulo}">
                    </a>
                </div>
                ` : '' }
                <div class="post-content">
                    <div class="post-header">
                        <h2 class="post-title"><a href="${post.enlace}">${post.titulo}</a></h2>
                        <span class="meta-data">
                            <i class="fa fa-calendar"></i> ${post.fecha_formato} 
                            &nbsp;|&nbsp; 
                            <i class="fa fa-folder-open"></i> ${post.categoria}
                        </span>
                    </div>
                    <div class="post-excerpt">
                        <p>${post.resumen}</p>
                    </div>
                    <div class="post-footer">
                        <a href="${post.enlace}" class="btn btn-primary">Leer más</a>
                    </div>
                </div>
            </div>
            `;
            container.append(html);
        });
    }

    // --- FUNCIÓN DE SIDEBAR (Categorías, Tags, Recientes) ---
    // --- FUNCIÓN DE SIDEBAR (Categorías, Tags, Recientes) ---
    function renderSidebar(posts) {
        var categoriasCount = {};
        
        // 1. Contar categorías
        $.each(posts, function(i, post) {
            var cat = post.categoria || "General";
            if (!categoriasCount[cat]) categoriasCount[cat] = 0;
            categoriasCount[cat]++;
        });

        // 2. Renderizar lista de CATEGORÍAS
        var catList = $("#blog-categories-list");
        catList.empty();
        
        // AÑADIDO: Le ponemos la clase 'active' por defecto a "Ver todas"
        catList.append('<li><a href="#" class="filter-link active" data-filter="all">Ver todas</a></li>');
        
        $.each(categoriasCount, function(cat, count) {
            catList.append(`<li><a href="#" class="filter-link" data-filter="${cat}">${cat}</a> <span class="badge">${count}</span></li>`);
        });

        // 3. Renderizar TAGS
        var tagList = $("#blog-tags-list");
        tagList.empty();
        $.each(categoriasCount, function(cat, count) {
            tagList.append(`<a href="#" class="filter-link" data-filter="${cat}">${cat}</a>`);
        });

        // 4. Renderizar RECIENTES (Top 3)
        var recentList = $("#recent-posts-list");
        recentList.empty();
        var top3 = posts.slice(0, 3);
        $.each(top3, function(i, post) {
            recentList.append(`
                <li>
                    <a href="${post.enlace}">${post.titulo}</a>
                    <span class="post-date">${post.fecha_formato}</span>
                </li>
            `);
        });

        // --- EVENTO CLIC EN FILTROS (MODIFICADO) ---
        $(".filter-link").on("click", function(e) {
            e.preventDefault();
            
            // AÑADIDO: Gestión de la clase 'active' visual
            // 1. Quitamos 'active' de TODOS los enlaces de filtro (categorías y tags)
            $(".filter-link").removeClass("active");
            // 2. Se lo ponemos SOLO al que hemos clicado
            $(this).addClass("active");

            var filtro = $(this).data("filter");
            
            if (filtro === "all") {
                renderBlog(allPosts);
            } else {
                var filtered = allPosts.filter(function(p) {
                    return p.categoria === filtro;
                });
                renderBlog(filtered);
            }
        });
    }

    // --- BUSCADOR EN TIEMPO REAL ---
    $("#blog-search-input").on("keyup", function() {
        var val = $(this).val().toLowerCase();
        
        if (val === "") {
            renderBlog(allPosts);
        } else {
            var filtered = allPosts.filter(function(p) {
                // Buscamos en título y resumen
                return p.titulo.toLowerCase().indexOf(val) > -1 || 
                       p.resumen.toLowerCase().indexOf(val) > -1;
            });
            renderBlog(filtered);
        }
    });

});
</script>
</body>
</html>
